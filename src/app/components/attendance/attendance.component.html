<div class="page">
  <!-- Not Enrolled -->
  <div *ngIf="!hasJoinedGroup" class="empty">
    <i class="pi pi-users"></i>
    <h2>Not Enrolled</h2>
    <p>You need to be in a group assigned to a company to mark attendance</p>
    <p *ngIf="currentGroup && !currentGroup.company" class="warning-text">Your group needs to be assigned to a company first</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="hasJoinedGroup && currentGroup">
    
    <!-- Group -->
    <div class="group">
      <h2>{{ currentGroup.groupName }}</h2>
      <p>{{ currentGroup.company?.name }}</p>
      <p-tag value="Active" severity="success"></p-tag>
    </div>

    <!-- Attendance Status -->
    <div *ngIf="todayAttendance" class="marked">
      <div class="check">
        <i class="pi pi-check"></i>
      </div>
      <h3>Attendance Marked</h3>
      <div class="status">
        <p-tag [value]="getStatusText(todayAttendance.status)" [severity]="getStatusSeverity(todayAttendance.status)"></p-tag>
      </div>
      <div class="info">
        <span>{{ todayAttendance.checkInTime | date:'short' }}</span>
        <span *ngIf="todayAttendance.distanceMeters">{{ todayAttendance.distanceMeters | number:'1.0-0' }}m away</span>
      </div>
    </div>

    <!-- Location Warning -->
    <div *ngIf="!locationPermissionGranted" class="warning">
      <i class="pi pi-exclamation-triangle"></i>
      <h4>Location Required</h4>
      <p>Enable location to mark attendance</p>
      <p-button label="Enable" icon="pi pi-map-marker" severity="warn" (onClick)="getCurrentLocation()" [loading]="isLoading"></p-button>
    </div>

    <!-- Location -->
    <div *ngIf="currentLocation" class="location">
      <h4>Current Location</h4>
      <div class="coords">
        <div><span>Lat:</span> <code>{{ currentLocation.latitude | number:'1.6-6' }}</code></div>
        <div><span>Lng:</span> <code>{{ currentLocation.longitude | number:'1.6-6' }}</code></div>
        <div><span>Accuracy:</span> <code>{{ currentLocation.accuracy | number:'1.0-0' }}m</code></div>
      </div>
    </div>

    <!-- Actions -->
    <div class="actions">
      <p-button 
        [label]="isLoading ? 'Marking...' : 'Check-In'"
        icon="pi pi-user-check"
        (onClick)="markAttendance()"
        [disabled]="isLoading || !!todayAttendance || !locationPermissionGranted"
        [loading]="isLoading">
      </p-button>
      
      <p-button 
        *ngIf="locationPermissionGranted && !todayAttendance"
        label="Refresh Location" 
        icon="pi pi-refresh" 
        severity="secondary"
        (onClick)="getCurrentLocation()"
        [disabled]="isLoading">
      </p-button>
    </div>

    <!-- Messages -->
    <p-message *ngIf="!todayAttendance" severity="info" text="Be at the correct location"></p-message>
    <p-message *ngIf="todayAttendance" severity="success" text="Done for today"></p-message>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading">
    <p-progressSpinner></p-progressSpinner>
  </div>
</div>