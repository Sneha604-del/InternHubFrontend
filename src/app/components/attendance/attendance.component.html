<div class="attendance-container">
  <h2>Attendance</h2>
  
  <!-- Not Enrolled Message -->
  <div *ngIf="!hasJoinedGroup" class="not-enrolled-container">
    <mat-card>
      <mat-card-content class="text-center">
        <mat-icon class="large-icon">school</mat-icon>
        <h3>Not Enrolled</h3>
        <p>You are not enrolled in any internship group.</p>
        <button mat-raised-button color="primary" routerLink="/groups">
          Browse Groups
        </button>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Attendance Section -->
  <div *ngIf="hasJoinedGroup && currentGroup">
    <!-- Group Info -->
    <mat-card class="group-info">
      <mat-card-header>
        <mat-card-title>{{ currentGroup.groupName }}</mat-card-title>
        <mat-card-subtitle>{{ currentGroup.company?.name }}</mat-card-subtitle>
      </mat-card-header>
    </mat-card>

    <!-- Today's Attendance Status -->
    <mat-card *ngIf="todayAttendance" class="attendance-status">
      <mat-card-header>
        <mat-card-title class="success-text">Today's Attendance</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="status-item">
          <mat-icon [class]="getStatusColor(todayAttendance.status)">check_circle</mat-icon>
          <div class="status-details">
            <h4>{{ getStatusText(todayAttendance.status) }}</h4>
            <p>Check-in: {{ todayAttendance.checkInTime | date:'short' }}</p>
            <p *ngIf="todayAttendance.distanceMeters">Distance: {{ todayAttendance.distanceMeters | number:'1.0-0' }}m</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Location Permission -->
    <mat-card *ngIf="!locationPermissionGranted" class="warning-card">
      <mat-card-header>
        <mat-card-title class="warning-text">Location Required</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <p>Location access is required to mark attendance.</p>
        <button mat-raised-button color="warn" (click)="getCurrentLocation()" [disabled]="isLoading">
          <mat-icon>location_on</mat-icon>
          Enable Location
        </button>
      </mat-card-content>
    </mat-card>

    <!-- Current Location -->
    <mat-card *ngIf="currentLocation" class="location-card">
      <mat-card-content>
        <div class="location-item">
          <mat-icon color="primary">location_on</mat-icon>
          <div class="location-details">
            <h4>Current Location</h4>
            <p>Lat: {{ currentLocation.latitude | number:'1.6-6' }}</p>
            <p>Lng: {{ currentLocation.longitude | number:'1.6-6' }}</p>
            <p>Accuracy: {{ currentLocation.accuracy | number:'1.0-0' }}m</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Check-in Button -->
    <div class="checkin-section">
      <button 
        mat-raised-button 
        color="primary"
        class="checkin-button"
        (click)="markAttendance()"
        [disabled]="isLoading || !!todayAttendance || !locationPermissionGranted">
        <mat-icon>fingerprint</mat-icon>
        <span *ngIf="!isLoading">Check-In Attendance</span>
        <span *ngIf="isLoading">Marking Attendance...</span>
      </button>
      
      <p class="checkin-note" *ngIf="!todayAttendance">
        Make sure you are at the internship location before checking in.
      </p>
      
      <p class="checkin-note success-text" *ngIf="todayAttendance">
        Attendance already marked for today.
      </p>
    </div>

    <!-- Refresh Location Button -->
    <button 
      *ngIf="locationPermissionGranted && !todayAttendance"
      mat-stroked-button 
      color="primary"
      class="refresh-button"
      (click)="getCurrentLocation()"
      [disabled]="isLoading">
      <mat-icon>refresh</mat-icon>
      Refresh Location
    </button>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Processing...</p>
  </div>
</div>